<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VIT Admin Login</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#04070a;
  --panel:#0a0f14;
  --accent:#22c55e;
  --text:#e8eef5;
  --danger:#f87171;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Arial,system-ui,sans-serif;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  width:100%;
  max-width:420px;
  padding:30px;
  background:var(--panel);
  border-radius:14px;
  border:1px solid #22c55e33;
  box-shadow:0 0 40px #22c55e22;
  text-align:center;
}

input{
  width:100%;
  padding:14px;
  margin-top:14px;
  border-radius:8px;
  background:transparent;
  border:2px solid var(--accent);
  color:var(--text);
  font-size:16px;
}

button{
  width:100%;
  padding:14px;
  margin-top:20px;
  border-radius:8px;
  background:var(--accent);
  color:#000;
  font-weight:800;
  cursor:pointer;
}

.error{
  margin-top:12px;
  color:var(--danger);
  min-height:20px;
}
</style>

</head>
<body>

<div class="container">
  <img src="vit-logo.png" alt="logo" style="width:160px;margin-bottom:20px;">
  <h2 style="color:var(--accent);margin-bottom:10px;">VIT Admin Portal</h2>

  <input id="adminEmail" placeholder="Admin Email">
  <input id="adminPass" type="password" placeholder="Admin Password">
  <button onclick="adminLogin()">Login</button>
  <div id="errorBox" class="error"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { 
  getFirestore, doc, getDoc, setDoc, collection, getDocs 
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey:"AIzaSyCxJ_K3VqK_xG10czTYiVtUDqHs5-mkM34",
  authDomain:"warehouse-management-sys-fe316.firebaseapp.com",
  projectId:"warehouse-management-sys-fe316",
  storageBucket:"warehouse-management-sys-fe316.appspot.com",
  messagingSenderId:"386376589251",
  appId:"1:386376589251:web:79ace33d41cbbdd4d92776"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* 20-CHARACTER ULTRA SECURE PASSWORD */
function generatePassword(){
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}";
  return Array.from({length:20},()=>chars[Math.floor(Math.random()*chars.length)]).join("");
}

/* AUTO-CREATE FIRST SUPER ADMIN (lowercase doc ID) */
async function autoCreateSuperAdmin(){
  const snap = await getDocs(collection(db, "vitportal-admins"));

  if (snap.empty){
    const email = "andrew@vitsupport.com";   // LOWERCASE FIX
    const password = generatePassword();

    await setDoc(doc(db, "vitportal-admins", email), {
      email: email,
      password: password,
      role: "PortalAdmin",
      createdAt: new Date().toISOString()
    });
  }
}

await autoCreateSuperAdmin();

/* LOGIN */
window.adminLogin = async function(){

  const emailRaw = document.getElementById("adminEmail").value.trim();
  const password = document.getElementById("adminPass").value.trim();
  const errorBox = document.getElementById("errorBox");

  errorBox.textContent = "";

  if(!emailRaw || !password){
    errorBox.textContent = "All fields are required.";
    return;
  }

  const email = emailRaw.toLowerCase();   // LOWERCASE FIX

  try {
    const ref = doc(db, "vitportal-admins", email);
    const snap = await getDoc(ref);

    if (!snap.exists()){
      errorBox.textContent = "Admin does not exist.";
      return;
    }

    const data = snap.data();

    if (data.password !== password){
      errorBox.textContent = "Incorrect password.";
      return;
    }

    localStorage.setItem("vitAdmin", email);
    localStorage.setItem("vitAdminPass", password);

    window.location.href = "vit-portal.html";

  } catch (e){
    console.error(e);
    errorBox.textContent = "Login failed. Check connection.";
  }
};

</script>

</body>
</html>
